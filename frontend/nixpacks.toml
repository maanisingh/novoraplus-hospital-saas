[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = ["npm ci --legacy-peer-deps"]

[phases.build]
# Force clean rebuild by clearing cache - v2.0.0
cmds = [
    "rm -rf .next",
    "NEXT_PUBLIC_DIRECTUS_URL=https://directus-production-0b20.up.railway.app npm run build"
]

[start]
cmd = "npm run start"

[variables]
NODE_ENV = "production"
BUILD_VERSION = "3.0.0"
BUILD_TIMESTAMP = "2025-11-30T14:35:00Z"
CACHE_BUST = "force-rebuild-staff-credentials"
